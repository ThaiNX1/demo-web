<p-toast></p-toast>
<form *ngIf="display" class="w-12" [formGroup]="customerForm" autocomplete="off">
    <div class="p-0 md:p-4 card grid">
        <div class="col-12 md:col-3 flex justify-content-center">
            <div class="md:fixed flex flex-column">
                <div class="flex justify-content-center">
                    <img *ngIf="customerForm.value.avatar" class="cursor-pointer" style="border-radius: 50%;"
                        src="{{ serverURLImage + '/' + customerForm.value.avatar }}" alt="Avatar" width="150"
                        height="150" (click)="uploadFile.click()" />
                    <img *ngIf="!customerForm.value.avatar" class="cursor-pointer" style="border-radius: 50%;"
                        src="assets/layout/images/user.png" alt="Avatar" width="150" height="150"
                        (click)="uploadFile.click()" />
                    <input #uploadFile class="hidden" type="file" (change)="doAttachFile($event)" />
                </div>
                <!--status-->
                <!-- <div class="field flex flex-column mt-4">
                    <label htmlFor="status" [translate]="'label.job_status'"></label>
                    <p-dropdown id="status" [options]="types.status" [optionLabel]="'label'" [optionValue]="'value'"
                        [appendTo]="'body'" [(ngModel)]="customerForm.value.status" [formControlName]="'status'"
                        [placeholder]="'label.empty' | translate" [ngClass]="checkValidValidator('status')">
                    </p-dropdown>
                    <small *ngIf="checkValidValidator('status')" class="p-error"
                        [innerHTML]="'info.status' | translate"></small>
                </div> -->
            </div>
        </div>
        <div class="col-12 md:col-9">
            <p-accordion>
                <!--personal info-->
                <p-accordionTab>
                    <ng-template pTemplate="header">
                        <div class="flex flex-wrap">
                            <h5 class="m-0 mr-2" [translate]="'label.personal_info'"></h5>
                            <div class="flex align-items-center" *ngIf="(isInvalidForm && checkValidMultiValidator(['name', 'phone', 'facebook', 'gender',
                                        'birthday', 'provinceId', 'districtId', 'wardId', 'email', 'address']))">
                                <span class="p-error" style="margin-top: 2px;"
                                    [translate]="'info.enter_personal_info' | translate"></span>
                            </div>
                        </div>
                    </ng-template>
                    <ng-template pTemplate="content">
                        <div class="grid w-full mx-auto">
                            <!--code-->
                            <div class="field col-12 md:col-6 flex flex-column">
                                <label htmlFor="code">{{'label.customer_code' | translate}}<span class="text-pink-400">*</span></label>
                                <input pInputText id="code" [(ngModel)]="customerForm.value.code" formControlName="code"
                                    [class.ng-invalid]="checkValidValidator('code')"
                                    [class.ng-dirty]="checkValidValidator('code')" />
                                <small *ngIf="checkValidValidator('code')" class="p-error" [innerHTML]="'info.customer_code' | translate"></small>
                            </div>

                            <!--fullName-->
                            <div class="field col-12 md:col-6 flex flex-column">
                                <label htmlFor="name">{{'label.customer_name' | translate}}<span class="text-pink-400">*</span></label>
                                <input pInputText id="name" [(ngModel)]="customerForm.value.name" formControlName="name"
                                    [class.ng-invalid]="checkValidValidator('name')"
                                    [class.ng-dirty]="checkValidValidator('name')" />
                                <small *ngIf="checkValidValidator('name')" class="p-error"
                                    [innerHTML]="'info.customer_name' | translate"></small>
                            </div>

                            <!--phone-->
                            <div class="field col-12 md:col-6 flex flex-column">
                                <label htmlFor="phone" [translate]="'label.phone'"></label>
                                <input pInputText id="phone" [(ngModel)]="customerForm.value.phone"
                                    formControlName="phone" />
                            </div>

                            <!--facebook-->
                            <div class="field col-12 md:col-6 flex flex-column">
                                <label htmlFor="facebook" [translate]="'label.facebook'"></label>
                                <input pInputText id="facebook" [(ngModel)]="customerForm.value.facebook"
                                    formControlName="facebook" />
                            </div>

                            <!--gender-->
                            <div class="field col-12 md:col-6 flex flex-column">
                                <label for="gender" [translate]="'label.gender'"></label>
                                <div class="flex">
                                    <div class="field-radiobutton md:pr-6 mt-2 pt-1">
                                        <p-radioButton id="gender1" name="gender" value="false"
                                            [(ngModel)]="customerForm.value.gender"
                                            [formControlName]="'gender'"></p-radioButton>
                                        <label for="gender1" [translate]="'label.male'"></label>
                                    </div>
                                    <div class="field-radiobutton mt-2 pt-1">
                                        <p-radioButton id="gender2" name="gender" value="true"
                                            [(ngModel)]="customerForm.value.gender" [formControlName]="'gender'">
                                        </p-radioButton>
                                        <label for="gender2" [translate]="'label.female'"></label>
                                    </div>
                                </div>
                            </div>

                            <!--birthday-->
                            <div class="field col-12 md:col-6 flex flex-column">
                                <label htmlFor="birthday" [translate]="'label.birthday'"></label>
                                <p-inputMask mask="99/99/9999" [(ngModel)]="customerForm.value.birthday"
                                    formControlName="birthday" slotChar="dd/mm/yyyy"></p-inputMask>
                            </div>

                            <!--province-->
                            <div class="field col-12 md:col-6 flex flex-column">
                                <label htmlFor="provinceId" [translate]="'label.province'"></label>
                                <p-dropdown id="provinceId" [options]="provinces" [optionLabel]="'name'"
                                    [optionValue]="'id'" showClear="true" [(ngModel)]="customerForm.value.provinceId"
                                    [formControlName]="'provinceId'" [appendTo]="'body'"
                                    [placeholder]="'label.empty' | translate" [filter]="true" filterBy="name"
                                    (onChange)="getDistrict($event)">
                                </p-dropdown>
                            </div>

                            <!--district-->
                            <div class="field col-12 md:col-6 flex flex-column">
                                <label htmlFor="districtId" [translate]="'label.district'"></label>
                                <p-dropdown id="districtId" [options]="districts" [optionLabel]="'name'"
                                    [optionValue]="'id'" showClear="true" [(ngModel)]="customerForm.value.districtId"
                                    [formControlName]="'districtId'" [appendTo]="'body'"
                                    [placeholder]="'label.empty' | translate" [filter]="true"
                                    filterBy="name" (onChange)="getWard($event)">
                                </p-dropdown>
                            </div>

                            <!--ward-->
                            <div class="field col-12 md:col-6 flex flex-column">
                                <label htmlFor="wardId" [translate]="'label.ward'"></label>
                                <p-dropdown id="wardId" [options]="wards" [optionLabel]="'name'" [optionValue]="'id'"
                                    showClear="true" [(ngModel)]="customerForm.value.wardId"
                                    [formControlName]="'wardId'" [appendTo]="'body'"
                                    [placeholder]="'label.empty' | translate" [filter]="true" filterBy="name"></p-dropdown>
                            </div>

                            <!--email-->
                            <div class="field col-12 md:col-6 flex flex-column">
                                <label htmlFor="email">{{'label.email' | translate}}<span class="text-pink-400">*</span></label>
                                <input pInputText id="email" [(ngModel)]="customerForm.value.email"
                                    formControlName="email" [class.ng-invalid]="checkValidValidator('email')"
                                    [class.ng-dirty]="checkValidValidator('email')" />
                                <small *ngIf="checkValidValidator('email')" class="p-error"
                                    [innerHTML]="'info.email' | translate"></small>
                            </div>

                            <!--address-->
                            <div class="field col-12 md:col-6 flex flex-column">
                                <label htmlFor="address" [translate]="'label.address'"></label>
                                <input pInputText id="address" [(ngModel)]="customerForm.value.address"
                                    formControlName="address" />
                            </div>
                        </div>

                        <p-divider></p-divider>

                        <!--identify info-->
                        <div class="grid w-full mx-auto">
                            <div class="col-12 flex flex-wrap">
                                <h5 class="m-0 mr-2" [translate]="'label.identify'"></h5>
                            </div>

                            <!--identify-->
                            <div class="field col-12 md:col-6 flex flex-column">
                                <label htmlFor="identityCardNo" [translate]="'label.identify'"></label>
                                <input pInputText id="identityCardNo" [(ngModel)]="customerForm.value.identityCardNo"
                                    formControlName="identityCardNo" />
                            </div>

                            <!--identifyCreatedDate-->
                            <div class="field col-12 md:col-6 flex flex-column">
                                <label htmlFor="identityCardIssueDate"
                                    [translate]="'label.identify_created_date'"></label>
                                <p-inputMask mask="99/99/9999" [(ngModel)]="customerForm.value.identityCardIssueDate"
                                    formControlName="identityCardIssueDate" slotChar="dd/mm/yyyy"></p-inputMask>
                            </div>

                            <!--identifyCreatedPlace-->
                            <div class="field col-12 md:col-6 flex flex-column">
                                <label htmlFor="identityCardIssuePlace"
                                    [translate]="'label.identify_created_place'"></label>
                                <input pInputText id="identityCardIssuePlace"
                                    [(ngModel)]="customerForm.value.identityCardIssuePlace"
                                    formControlName="identityCardIssuePlace" />
                            </div>

                            <!--identifyExpiredDate-->
                            <div class="field col-12 md:col-6 flex flex-column">
                                <label htmlFor="identityCardValidUntil"
                                    [translate]="'label.identify_expired_date'"></label>
                                <p-inputMask mask="99/99/9999" [(ngModel)]="customerForm.value.identityCardValidUntil"
                                    formControlName="identityCardValidUntil" slotChar="dd/mm/yyyy"></p-inputMask>
                            </div>

                            <!--nativeProvinceId-->
                            <div class="field col-12 md:col-6 flex flex-column">
                                <label htmlFor="identityCardProvinceId" [translate]="'label.native_province'"></label>
                                <p-dropdown id="identityCardProvinceId" [options]="nativeProvinces"
                                    [optionLabel]="'name'" [optionValue]="'id'" showClear="true"
                                    [(ngModel)]="customerForm.value.identityCardProvinceId"
                                    [formControlName]="'identityCardProvinceId'" [appendTo]="'body'"
                                    [placeholder]="'label.empty' | translate" [filter]="true" filterBy="name"
                                    (onChange)="getNativeDistrict($event)">
                                </p-dropdown>
                            </div>

                            <!--nativeDistrictId-->
                            <div class="field col-12 md:col-6 flex flex-column">
                                <label htmlFor="identityCardDistrictId" [translate]="'label.native_district'"></label>
                                <p-dropdown id="identityCardDistrictId" [options]="nativeDistricts"
                                    [optionLabel]="'name'" [optionValue]="'id'" showClear="true"
                                    [(ngModel)]="customerForm.value.identityCardDistrictId"
                                    [formControlName]="'identityCardDistrictId'" [appendTo]="'body'"
                                    [placeholder]="'label.empty' | translate" [filter]="true" filterBy="name"
                                    (onChange)="getNativeWard($event)">
                                </p-dropdown>
                            </div>

                            <!--nativeWardId-->
                            <div class="field col-12 md:col-6 flex flex-column">
                                <label htmlFor="identityCardWardId" [translate]="'label.native_ward'"></label>
                                <p-dropdown id="identityCardWardId" [options]="nativeWards" [optionLabel]="'name'"
                                    [optionValue]="'id'" showClear="true"
                                    [(ngModel)]="customerForm.value.identityCardWardId"
                                    [formControlName]="'identityCardWardId'" [appendTo]="'body'"
                                    [placeholder]="'label.empty' | translate" [filter]="true" filterBy="name"></p-dropdown>
                            </div>

                            <!--placeOfPermanent-->
                            <div class="field col-12 md:col-6 flex flex-column">
                                <label htmlFor="identityCardPlaceOfPermanent"
                                    [translate]="'label.place_of_permanent'"></label>
                                <input pInputText id="identityCardPlaceOfPermanent"
                                    [(ngModel)]="customerForm.value.identityCardPlaceOfPermanent"
                                    formControlName="identityCardPlaceOfPermanent" />
                            </div>
                        </div>
                    </ng-template>
                </p-accordionTab>

                <!--billing information-->
                <p-accordionTab>
                    <ng-template pTemplate="header">
                        <div class="flex flex-wrap">
                            <h5 class="m-0 mr-2" [translate]="'label.billing_information'"></h5>
                            <div class="flex align-items-center"
                                *ngIf="(isInvalidForm && checkValidMultiValidator(['companyNameTax', 'addressTax', 'taxCode', 'accountNumberTax', 'bankTax', 'phoneTax']))">
                                <span class="p-error" style="margin-top: 2px;"
                                    [translate]="'info.enter_billing_information' | translate"></span>
                            </div>
                        </div>
                    </ng-template>
                    <ng-template pTemplate="content">
                        <div class="grid w-full mx-auto">
                            <!--company_name-->
                            <div class="field col-12 md:col-4 flex flex-column">
                                <label htmlFor="companyNameTax" [translate]="'label.company_name'"></label>
                                <input pInputText id="companyNameTax" [(ngModel)]="customerForm.value.companyNameTax"
                                    formControlName="companyNameTax" />
                            </div>
                            <!--tax_code-->
                            <div class="field col-12 md:col-4 flex flex-column">
                                <label htmlFor="taxCode" [translate]="'label.tax_code'"></label>
                                <input pInputText id="taxCode" [(ngModel)]="customerForm.value.taxCode"
                                    formControlName="taxCode" />
                            </div>
                            <!--address-->
                            <div class="field col-12 md:col-4 flex flex-column">
                                <label htmlFor="addressTax" [translate]="'label.address'"></label>
                                <input pInputText id="addressTax" [(ngModel)]="customerForm.value.addressTax"
                                    formControlName="addressTax" />
                            </div>
                            <!--phone_number-->
                            <div class="field col-12 md:col-4 flex flex-column">
                                <label htmlFor="phoneTax" [translate]="'label.phone_number'"></label>
                                <input pInputText id="phoneTax" [(ngModel)]="customerForm.value.phoneTax"
                                    formControlName="phoneTax" />
                            </div>
                            <!--account_number-->
                            <div class="field col-12 md:col-4 flex flex-column">
                                <label htmlFor="accountNumberTax" [translate]="'label.bank_account'"></label>
                                <input pInputText id="accountNumberTax"
                                    [(ngModel)]="customerForm.value.accountNumberTax"
                                    formControlName="accountNumberTax" />
                            </div>
                            <!--banking-->
                            <div class="field col-12 md:col-4 flex flex-column">
                                <label htmlFor="bankTax" [translate]="'label.bank_name'"></label>
                                <input pInputText id="bankTax" [(ngModel)]="customerForm.value.bankTax"
                                    formControlName="bankTax" />
                            </div>
                        </div>
                    </ng-template>
                </p-accordionTab>

                <!--Account Connection-->
                <p-accordionTab>
                    <ng-template pTemplate="header">
                        <div class="flex flex-wrap">
                            <h5 class="m-0 mr-2" [translate]="'label.account_connection'"></h5>
                            <div class="flex align-items-center"
                                *ngIf="(isInvalidForm && checkValidMultiValidator(['debitCode', 'debitDetailCodeFirst', 'debitDetailCodeSecond']))">
                                <span class="p-error" style="margin-top: 2px;"
                                    [translate]="'info.enter_connection_info' | translate"></span>
                            </div>
                        </div>
                    </ng-template>
                    <ng-template pTemplate="content">
                        <div class="grid w-full mx-auto">
                            <!--debit-->
                            <div class="field col-12 md:col-4 flex flex-column">
                                <label htmlFor="debit" [translate]="'label.account'"></label>
                                <div class="p-inputgroup w-full">
                                    <p-autoComplete id="debit" [(ngModel)]="customerForm.value.debitCode" [showEmptyMessage]="true"
                                        [suggestions]="filteredDebitNames" #debit (onSelect)="onDebitSelect($event)" [disabled]="debits1.length > 0"
                                        (completeMethod)="filterDebitName($event)" [minLength]="1" [ngModelOptions]="{ standalone: true }"
                                        class="p-inputtext-sm" [completeOnFocus]="true">
                                    </p-autoComplete>
                                    <div class="p-inputgroup-addon cursor-pointer" (click)="onChangeCreditDebit(null, 'debit'); onFocus(vcDebit);"><i
                                            class="pi pi-times"></i></div>
                                </div>
                            </div>

                            <!--debit1-->
                            <div class="field col-12 md:col-4 flex flex-column">
                                <label htmlFor="debit1" [translate]="'label.detail_1'"></label>
                                <div class="p-inputgroup w-full">
                                    <p-autoComplete id="debit1" [(ngModel)]="customerForm.value.debitDetailCodeFirst" [showEmptyMessage]="true" #debit1
                                        [suggestions]="filteredDebit1Names" (onSelect)="onDebit1Select($event)"
                                        (completeMethod)="filterDebit1Name($event)" [disabled]="debits1.length === 0 || debits2.length > 0" [minLength]="1"
                                        [ngModelOptions]="{ standalone: true }" class="p-inputtext-sm" [completeOnFocus]="true">
                                    </p-autoComplete>
                                    <div class="p-inputgroup-addon cursor-pointer" (click)="onChangeCreditDebit(null, 'debit1'); onFocus(vcDebit1);"><i
                                            class="pi pi-times"></i></div>
                                </div>
                            </div>

                            <!--debit2-->
                            <div class="field col-12 md:col-4 flex flex-column">
                                <label htmlFor="debit2" [translate]="'label.detail_2'"></label>
                                <div class="p-inputgroup w-full">
                                    <p-autoComplete id="debit2" [(ngModel)]="customerForm.value.debitDetailCodeSecond" [showEmptyMessage]="true"
                                        [disabled]="debits2.length === 0" [suggestions]="filteredDebit2Names" (onSelect)="onDebit2Select($event)"
                                        (completeMethod)="filterDebit2Name($event)" [minLength]="1" [ngModelOptions]="{ standalone: true }" #debit2
                                        class="p-inputtext-sm" [completeOnFocus]="true">
                                    </p-autoComplete>
                                    <div class="p-inputgroup-addon cursor-pointer" (click)="onChangeCreditDebit(null, 'debit2'); onFocus(vcDebit2);"><i
                                            class="pi pi-times"></i></div>
                                </div>
                            </div>
                        </div>
                    </ng-template>
                </p-accordionTab>

                <!--accountant information-->
                <p-accordionTab>
                    <ng-template pTemplate="header">
                        <div class="flex flex-wrap">
                            <h5 class="m-0 mr-2" [translate]="'label.account_infor'"></h5>
                            <div class="flex align-items-center"
                                *ngIf="(isInvalidForm && checkValidMultiValidator(['accountantTax', 'positionTax', 'phoneOfAccountantTax']))">
                                <span class="p-error" style="margin-top: 2px;"
                                    [translate]="'info.enter_account_info' | translate"></span>
                            </div>
                        </div>
                    </ng-template>
                    <ng-template pTemplate="content">
                        <div class="grid w-full mx-auto">
                            <!--accountantName-->
                            <div class="field col-12 md:col-4 flex flex-column">
                                <label htmlFor="accountantName" [translate]="'label.account_name'"></label>
                                <input pInputText id="accountantName" [(ngModel)]="customerForm.value.accountantTax"
                                    formControlName="accountantTax" />
                            </div>
                            <!--accountantPosition-->
                            <div class="field col-12 md:col-4 flex flex-column">
                                <label htmlFor="accountantPosition" [translate]="'label.accountant_position'"></label>
                                <input pInputText id="accountantPosition" [(ngModel)]="customerForm.value.positionTax"
                                    formControlName="positionTax" />
                            </div>
                            <!--accountantPhone-->
                            <div class="field col-12 md:col-4 flex flex-column">
                                <label htmlFor="accountantPhone" [translate]="'label.phone_number'"></label>
                                <input pInputText id="accountantPhone"
                                    [(ngModel)]="customerForm.value.phoneOfAccountantTax"
                                    formControlName="phoneOfAccountantTax" />
                            </div>
                        </div>
                    </ng-template>
                </p-accordionTab>
            </p-accordion>
        </div>
        <div class="col-12">
            <div class="p-fluid p-formgrid grid mt-2">
                <div class="field col-12 gap-8 flex justify-content-end mt-4 p-0">
                    <p-button icon="pi pi-times" (click)="onCancel.emit({})" [label]="'button.back' | translate"
                        styleClass="p-button-outlined"></p-button>
                    <p-button icon="pi pi-check" (click)="onSubmit()" [label]="'button.save' | translate"></p-button>
                </div>
            </div>
        </div>
    </div>
</form>
